<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlyTau Manager - דוחות ניהוליים</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="manager-reports">

  <aside class="sidebar">
    <a href="/manager" class="brand-area">
      <span class="brand-text">FLYTAU</span>
      <img src="{{ url_for('static', filename='img/LOGO.png') }}" alt="FLYTAU Logo" class="brand-logo">
    </a>

    <div class="nav-category">ניהול שוטף</div>
    <nav class="nav flex-column">
      <a href="/manager" class="nav-link"><i class="bi bi-grid-1x2"></i> לוח טיסות</a>
      <a href="/manager/add_flight/step1" class="nav-link"><i class="bi bi-plus-lg"></i> הוספת טיסה</a>
      <a href="/manager/add_plane" class="nav-link"><i class="bi bi-airplane"></i> הוספת מטוס</a>
      <a href="/manager/add_staff" class="nav-link"><i class="bi bi-people"></i> ניהול צוות</a>
    </nav>

    <div class="nav-category">מערכת</div>
    <nav class="nav flex-column">
      <a href="/manager/reports" class="nav-link active"><i class="bi bi-bar-chart"></i> דוחות ניהוליים</a>
      <a href="/logout" class="nav-link text-danger mt-4"><i class="bi bi-box-arrow-right"></i> יציאה</a>
    </nav>
  </aside>

  <main class="main-wrapper">
    <header class="top-header">
      <div class="page-heading">
        <h1>דוחות ניהוליים</h1>
        <p>סקירה מהירה של ביצועי המערכת והצגת גרפים מתוך נתוני ההזמנות</p>
      </div>

      <a href="/manager" class="btn-back-custom">
        <i class="bi bi-arrow-right"></i> חזרה ללוח טיסות
      </a>
    </header>

    <section class="stats-grid">
      <div class="kpi-box">
        <div class="kpi-label">סה״כ הזמנות</div>
        <div class="kpi-value">{{ total_orders }}</div>
      </div>

      <div class="kpi-box">
        <div class="kpi-label">הכנסות</div>
        <div class="kpi-value">₪{{ total_revenue }}</div>
      </div>

      <div class="kpi-box">
        <div class="kpi-label">ביטולים</div>
        <div class="kpi-value">{{ cancelled_orders }}</div>
      </div>

      <div class="kpi-box">
        <div class="kpi-label">תפוסה ממוצעת בטיסות</div>
        <div class="kpi-value">{{ "%.1f"|format(avg_total_occupancy) }}%</div>
      </div>
    </section>

    <section class="charts-grid">
      <div class="surface chart-wrap">
        <div class="chart-title">שיעור ביטולים חודשי</div>
        <div class="chart-subtitle">(12 חודשים אחרונים)</div>
        <div class="chart-area">
          <img class="chart-img" src="{{ url_for('static', filename='reports/cancellation_rate.png') }}?v={{ total_orders }}" alt="Monthly Cancellation Rate">
        </div>
      </div>

      <div class="surface chart-wrap">
        <div class="chart-title">תפוסה ממוצעת</div>
        <div class="chart-area">
          <img class="chart-img" src="{{ url_for('static', filename='reports/avg_occupancy.png') }}?v={{ total_orders }}" alt="Average Occupancy">
        </div>
      </div>
    </section>

    <section class="surface">
      <div class="card-head">
        <div class="fw-bold text-dark">חמשת הנתיבים הדומיננטיים ביותר</div>
      </div>
      <div class="table-responsive">
        <table class="table mb-0">
          <thead>
            <tr>
              <th>מקור</th>
              <th>יעד</th>
              <th class="text-end">כמות</th>
            </tr>
          </thead>
          <tbody>
            {% if top_routes %}
              {% for r in top_routes %}
                <tr>
                  <td><strong>{{ r[0] }}</strong></td>
                  <td><strong>{{ r[1] }}</strong></td>
                  <td class="text-end">{{ r[2] }}</td>
                </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="3" class="text-center py-4 text-muted">אין נתונים</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </section>

  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>