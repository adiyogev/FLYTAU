<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FLYTAU - הרשמה</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --flytau-navy:#001b33;
      --flytau-teal:#00818a;
      --text-light:#64748b;
      --bg-input:#f8fafc;
      --border:#e2e8f0;
    }

    body{
      margin:0; padding:0;
      font-family:'Heebo', sans-serif;
      height:100vh;
      display:flex; overflow:hidden;
      background:white;
    }

    .panel{
      flex:1; background:white; 
      display:flex; flex-direction:column;
      align-items:center; 
      /* הקטנתי את הריווח החיצוני כדי שהתוכן יתחיל גבוה יותר */
      padding: 20px; 
      overflow-y:auto; 
    }

    .wrapper{ 
        width:100%; max-width:460px; animation:fadeIn .8s ease-out; 
        /* ביטול המרכוז האנכי - עכשיו זה צמוד למעלה */
        margin-top: 10px; 
        margin-bottom: 40px;
        padding-top: 0;
    }
    
    @keyframes fadeIn{ from{opacity:0; transform:translateY(20px);} to{opacity:1; transform:translateY(0);} }

    .title-row{ display:flex; align-items:center; justify-content:center; gap:12px; margin-bottom:10px; }
    .inline-logo{ height:44px; width:auto; object-fit:contain; background:transparent; display:block; position: relative; top: 6px; }

    h1{
      font-size:32px; color:var(--flytau-navy); margin:0; font-weight:800;
      line-height:1.2; padding-top:8px; text-align:center;
    }

    .subtitle{ color:var(--text-light); font-size:16px; margin:0 0 22px 0; text-align:center; line-height:1.5; }

    .notice{
      display:none; border:1px solid rgba(239,68,68,0.35); background:rgba(239,68,68,0.07);
      color:#7f1d1d; padding:12px 14px; border-radius:12px; font-weight:800;
      line-height:1.5; margin-bottom:16px;
    }
    .notice.ok{ border-color: rgba(16,185,129,0.35); background: rgba(16,185,129,0.08); color:#064e3b; }

    .grid{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
    @media (max-width:520px){ .grid{grid-template-columns:1fr;} .inline-logo{height:40px; top:6px;} h1{font-size:30px;} }

    .input-group{margin-bottom:16px;}
    .label{display:block; font-size:14px; font-weight:700; color:var(--flytau-navy); margin-bottom:8px;}
    
    .input-box{
      display:flex; align-items:center; background:var(--bg-input);
      border:1px solid var(--border); border-radius:12px; transition:.3s;
      position: relative;
    }
    .input-box:focus-within{ border-color:var(--flytau-teal); background:white; box-shadow:0 0 0 4px rgba(0,129,138,.1); }
    .input-box i.icon-start{padding:0 15px; color:#94a3b8; font-size:18px;}
    .input-box input{
      border:none; background:transparent; width:100%; padding:16px 0;
      font-size:16px; outline:none; color:var(--flytau-navy); font-weight:500; font-family: inherit;
    }
    .hint{ margin-top:7px; font-size:12px; color:var(--text-light); line-height:1.4; }

    /* סגנונות לשדות הטלפון הדינמיים */
    .phone-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; animation: slideDown 0.3s ease-out; }
    .phone-row .input-box { flex: 1; }
    .btn-remove-phone {
        background: #fee2e2; color: #ef4444; border: none; width: 40px; height: 40px;
        border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center;
        transition: 0.2s;
    }
    .btn-remove-phone:hover { background: #fecaca; }
    
    .btn-add-phone {
        background: transparent; border: 1px dashed var(--flytau-teal); color: var(--flytau-teal);
        padding: 8px 15px; border-radius: 8px; font-size: 13px; font-weight: 700; cursor: pointer;
        display: inline-flex; align-items: center; gap: 5px; transition: 0.2s;
    }
    .btn-add-phone:hover { background: rgba(13, 148, 136, 0.05); }

    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }

    .btn{
      width:100%; background:var(--flytau-navy); color:white; border:none;
      padding:18px; border-radius:12px; font-size:16px; font-weight:800;
      cursor:pointer; transition:.3s; display:flex; justify-content:center; align-items:center; gap:10px;
      box-shadow:0 10px 20px rgba(0,27,51,.15); margin-top:6px; font-family: inherit;
    }
    .btn:hover{ background:#002d54; transform:translateY(-2px); box-shadow:0 15px 30px rgba(0,27,51,.25); }
    .btn:disabled{ background:#334155; opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }

    .links{margin-top:18px; text-align:center; font-size:14px; color:var(--text-light);}
    .links a{color:var(--flytau-teal); text-decoration:none; font-weight:800;}
    .links a:hover{color:var(--flytau-navy); text-decoration:underline;}

    .image-section{
      flex:1.3; background-image:url('https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=2074&auto=format&fit=crop');
      background-size:cover; background-position:center; position:relative;
      display:flex; flex-direction:column; justify-content:flex-end; padding:80px; color:white;
    }
    .overlay{ position:absolute; inset:0; background:linear-gradient(to top, rgba(0,27,51,0.95) 0%, rgba(0,27,51,0.4) 60%, rgba(0,27,51,0.1) 100%); }
    .promo-content{position:relative; z-index:2; max-width:600px; animation:slideUp 1s ease-out;}
    @keyframes slideUp{ from{opacity:0; transform:translateY(40px);} to{opacity:1; transform:translateY(0);} }
    .promo-tag{
      display:inline-block; background:var(--flytau-teal); color:white;
      padding:6px 16px; border-radius:20px; font-size:12px; font-weight:800;
      margin-bottom:25px; text-transform:uppercase; letter-spacing:1px;
    }
    .promo-title{font-size:64px; font-weight:800; margin-bottom:20px; line-height:1.1;}
    .promo-desc{font-size:20px; opacity:.9; line-height:1.6; max-width:90%; font-weight:300;}

    @media (max-width:1000px){
      .image-section{display:none;}
      body{background:#f8fafc;}
      .panel{width:100%; flex:none; background:#f8fafc;}
      .wrapper{background:white; padding:40px; border-radius:24px; box-shadow:0 10px 30px rgba(0,0,0,0.05);}
    }
  </style>
</head>

<body>

  <div class="panel">
    <div class="wrapper">
      <div class="title-row">
        <img class="inline-logo" src="{{ url_for('static', filename='LOGO.png') }}" alt="FLYTAU">
        <h1>הרשמה</h1>
      </div>
      <p class="subtitle">ממלאים פרטים פעם אחת — וממשיכים להזמין מהר יותר.</p>
      
      {% if message %}
      <div class="notice {% if 'Already' not in message and 'אימייל' not in message %}ok{% endif %}" role="alert" aria-live="polite" style="display: block;">
        {{ message }}
      </div>
      {% else %}
      <div id="notice" class="notice" role="alert" aria-live="polite"></div>
      {% endif %}

      <form id="signupForm" action="/register" method="POST" novalidate>
        <input type="hidden" name="next_url_hidden" value="{{ request.args.get('next', '') }}">
        
        <div class="grid">
          <div class="input-group">
            <label class="label">שם פרטי (באנגלית)</label>
            <div class="input-box"><i class="fas fa-user icon-start"></i><input id="first_name" name="first_name" type="text" placeholder="דנה" required></div>
          </div>
          <div class="input-group">
            <label class="label">שם משפחה (באנגלית)</label>
            <div class="input-box"><i class="fas fa-user icon-start"></i><input id="last_name" name="last_name" type="text" placeholder="כהן" required></div>
          </div>
        </div>

        <div class="grid">
          <div class="input-group">
            <label class="label">מספר דרכון</label>
            <div class="input-box"><i class="fas fa-passport icon-start"></i><input id="passport" name="passport" type="text" placeholder="A12345678" required></div>
            <div class="hint">כמו שמופיע בדרכון (אותיות/ספרות).</div>
          </div>
          <div class="input-group">
            <label class="label">תאריך לידה</label>
            <div class="input-box"><i class="fas fa-cake-candles icon-start"></i><input id="dob" name="birth_date" type="date" required></div>
          </div>
        </div>

        <div class="input-group">
          <label class="label">אימייל</label>
          <div class="input-box"><i class="far fa-envelope icon-start"></i><input id="email" name="customer_email" type="email" placeholder="name@example.com" autocomplete="email" required></div>
        </div>

        <div class="input-group">
            <label class="label">טלפון נייד</label>
            <div id="phones-container">
                <div class="phone-row">
                    <div class="input-box">
                        <i class="fas fa-phone icon-start"></i>
                        <input type="tel" name="phone_numbers" placeholder="050-1234567" required class="phone-input">
                    </div>
                </div>
            </div>
            <button type="button" class="btn-add-phone" onclick="addPhoneField()">
                <i class="fas fa-plus"></i> הוסף מספר נוסף
            </button>
        </div>

        <div class="input-group">
          <label class="label">סיסמה</label>
          <div class="input-box"><i class="fas fa-lock icon-start"></i><input id="password" name="password" type="password" placeholder="••••••••" minlength="8" required></div>
          <div class="hint"></div>
        </div>

        <button id="submitBtn" class="btn" type="submit">יצירת חשבון <i class="fas fa-arrow-left"></i></button>
        <div class="links">כבר יש לך חשבון? <a href="/login{% if request.args.get('next') %}?next={{ request.args.get('next') }}{% endif %}">להתחברות</a></div>
      </form>
    </div>
  </div>

  <div class="image-section" aria-hidden="true">
    <div class="overlay"></div>
    <div class="promo-content">
      <div class="promo-tag">JOIN FLYTAU</div>
      <div class="promo-title">פותחים חשבון,<br>ומתחילים לטוס.</div>
      <div class="promo-desc">שמירה של הפרטים שלך כדי להפוך כל הזמנה למהירה, מסודרת ונוחה יותר.</div>
    </div>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);
    const phonesContainer = $('phones-container');

    function setNotice(msg, type="error"){
      const n = $("notice"); n.className = "notice" + (type==="ok" ? " ok" : "");
      n.textContent = msg; n.style.display = "block";
    }
    function clearNotice(){ const n = $("notice"); n.textContent = ""; n.style.display = "none"; n.className = "notice"; }

    function addPhoneField() {
        const div = document.createElement('div');
        div.className = 'phone-row';
        div.innerHTML = `
            <div class="input-box">
                <i class="fas fa-phone icon-start"></i>
                <input type="tel" name="phone_numbers" placeholder="050-1234567" class="phone-input">
            </div>
            <button type="button" class="btn-remove-phone" onclick="removePhone(this)" title="מחק מספר">
                <i class="fas fa-trash"></i>
            </button>
        `;
        phonesContainer.appendChild(div);
        const input = div.querySelector('input');
        input.addEventListener("input", validateLive);
        input.addEventListener("change", validateLive);
        validateLive();
    }

    window.removePhone = function(btn) {
        btn.parentElement.remove();
        validateLive();
    }

    function validateLive(){
      const first = ($("first_name").value || "").trim();
      const last = ($("last_name").value || "").trim();
      const passport = ($("passport").value || "").trim();
      const dob = $("dob").value || "";
      const email = ($("email").value || "").trim();
      const pass = $("password").value || "";

      const phoneInputs = document.querySelectorAll('.phone-input');
      let isPhoneValid = false;
      phoneInputs.forEach(input => { if(input.value.trim().length >= 9) isPhoneValid = true; });

      const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      const passportOk = passport.length >= 6;
      const dobOk = !!dob;
      const passOk = pass.length >= 8;

      const allOk = first && last && passportOk && dobOk && emailOk && passOk && isPhoneValid;
      $("submitBtn").disabled = !allOk;

      if(email.length > 0 && !emailOk){ setNotice("האימייל לא נראה תקין. נסו שוב.", "error"); }
      else if(pass.length > 0 && !passOk){ setNotice("הסיסמה קצרה מדי. צריך לפחות 8 תווים.", "error"); }
      else { clearNotice(); }
    }

    ["first_name","last_name","passport","dob","email","password"].forEach(id=>{
      $(id).addEventListener("input", validateLive); $(id).addEventListener("change", validateLive);
    });
    document.querySelector('.phone-input').addEventListener("input", validateLive);

    // Form will submit normally to /register endpoint
    $("signupForm").addEventListener("submit", (e) => {
      const btn = $("submitBtn");
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> יוצר חשבון...';
    });
    validateLive();
  </script>
</body>
</html>