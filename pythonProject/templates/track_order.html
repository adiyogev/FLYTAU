<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLYTAU - איתור הזמנה</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="track-order-page">

    <header>
        <div class="header-right">
            <img src="{{ url_for('static', filename='img/LOGO.png') }}"
                 onerror="this.src='{{ url_for('static', filename='img/LOGO.png') }}';"
                 alt="FLYTAU" class="logo-img">
            <a href="/" class="nav-link">חיפוש טיסות</a>
        </div>
        <div class="header-left">
             <a href="/login" class="nav-link">התחברות</a>
        </div>
    </header>

    <div class="hero-banner" style="background-image: linear-gradient(rgba(0, 27, 51, 0.5), rgba(0, 27, 51, 0.5)), url('{{ url_for('static', filename='img/myorders.png') }}');">
        <h1>איתור הזמנה</h1>
    </div>

    <div class="container" style="max-width: 500px; margin: 20px auto -10px; position: relative; z-index: 999;">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="custom-flash-alert {{ category }}">
                        {% if category == 'success' %}
                            <i class="fas fa-check-circle"></i>
                        {% endif %}
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    <div class="search-card">
        {% if message %}
            <p class="error-msg-box">
                <i class="fas fa-exclamation-circle"></i> {{ message }}
            </p>
        {% endif %}

        <form method="POST">
            <div class="input-group">
                <label><i class="fas fa-hashtag"></i> קוד הזמנה (6 תווים):</label>
                <input type="text" name="order_code" class="form-input" required maxlength="6" placeholder="למשל: AB1234">
            </div>
            <div class="input-group">
                <label><i class="fas fa-envelope"></i> אימייל בהזמנה:</label>
                <input type="email" name="email" class="form-input" required placeholder="email@example.com">
            </div>
            <button type="submit" class="btn-search">חפש הזמנה <i class="fas fa-search"></i></button>
        </form>

        <span class="login-link">
            לקוח רשום? <a href="/login?next=/my_orders">התחבר כאן</a> לצפייה בכל ההזמנות.
        </span>
    </div>

    {% if order %}
    <div class="flight-card-modern track-result-card">
        <div class="card-header-row">
            <div>
                <div class="order-code">הזמנה #{{ order[0] }}</div>
                <div class="order-date">נמצאה במערכת</div>
            </div>

            <div class="status-badge {% if order[1] == 'active' %}status-active{% else %}status-completed{% endif %}">
                {% if order[1] == 'active' %}פעילה{% else %}{{ order[1] }}{% endif %}
            </div>
        </div>

        <div class="card-body-grid">
            <div class="location-col">
                <div class="city-name">מוצא</div>
                <div class="city-code">{{ order[3] }}</div>
                <div class="flight-time-big">
                    <span>{{ order[5].strftime('%H:%M') }}</span>
                </div>
                <div class="city-name" style="margin-top: 5px;">{{ order[5].strftime('%d/%m/%Y') }}</div>
            </div>

            <div class="timeline-col">
                <div class="plane-icon-divider">
                    <i class="fas fa-plane"></i>
                </div>
                <div class="timeline-line"></div>
            </div>

            <div class="location-col">
                <div class="city-name">יעד</div>
                <div class="city-code">{{ order[4] }}</div>
                <div class="flight-time-big">
                    <span>{{ order[8].strftime('%H:%M') }}</span>
                </div>
                <div class="city-name" style="margin-top: 5px;">{{ order[8].strftime('%d/%m/%Y') }}</div>
            </div>
        </div>

        <div class="card-footer-row">
            <div class="price-area">
                <span class="price-label">סה"כ שולם:</span>
                <span class="price-value">₪{{ order[2] }}</span>
            </div>

            {% if order[1] == 'active' %}
                <form action="/cancel_order/{{ order[0] }}" method="POST" onsubmit="return confirm('האם את בטוחה שברצונך לבטל את ההזמנה?');" style="margin:0;">
                    <button type="submit" class="btn-cancel">
                        <i class="fas fa-trash-alt"></i> ביטול הזמנה
                    </button>
                </form>
            {% endif %}
        </div>
    </div>
    {% endif %}

</body>
</html>