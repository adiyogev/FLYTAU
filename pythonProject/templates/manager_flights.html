<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FlyTau Manager - ניהול מערכת</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />
  <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800;900&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg-body:#eef6ff;
      --surface:#ffffff;
      --surface-2:#f8fafc;

      --sidebar-width:260px;

      --primary:#0284c7;
      --primary-2:#0ea5e9;
      --accent:#14b8a6;

      --text-dark:#0f172a;
      --text:#1e293b;
      --text-muted:#64748b;

      --border:rgba(226,232,240,.9);
      --radius:16px;

      --shadow-sm:0 1px 2px rgba(15,23,42,.06);
      --shadow-md:0 10px 25px rgba(15,23,42,.08);
      --shadow-lg:0 18px 55px rgba(15,23,42,.12);
    }

    *{ -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    body{
      font-family:'Heebo',sans-serif;
      color:var(--text);
      overflow-x:hidden;
      background:
        radial-gradient(900px 260px at 85% 0%, rgba(14,165,233,.14), transparent 60%),
        radial-gradient(720px 240px at 15% 0%, rgba(20,184,166,.12), transparent 55%),
        var(--bg-body);
    }

    /* --- Mobile toggle --- */
    .mobile-toggle{
      border-radius: 999px !important;
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border);
    }

    /* --- Sidebar --- */
    .sidebar{
      position:fixed;
      top:0;
      right:0;
      height:100vh;
      width:var(--sidebar-width);
      padding:16px 0;
      display:flex;
      flex-direction:column;
      z-index:1000;

      background: rgba(255,255,255,.92);
      backdrop-filter: blur(10px);
      border-left: 1px solid var(--border);
      box-shadow: 0 20px 60px rgba(15,23,42,.06);
    }

    .brand-area{
      padding: 14px 22px 12px;
      display:flex;
      align-items:center;
      gap:12px;
      font-size:1.35rem;
      font-weight:900;
      color:var(--text-dark);
      text-decoration:none;
      border-bottom: 1px solid var(--border);
    }
    .brand-area:hover{ color: var(--text-dark); }
    .brand-logo{
      width:78px;
      height:58px;
      object-fit:contain;
      filter: drop-shadow(0 6px 16px rgba(2,132,199,.12));
    }
    .brand-text{
      letter-spacing:-.6px;
    }

    .nav-category{
      padding: 12px 22px 6px;
      font-weight:800;
      font-size:.78rem;
      letter-spacing:.5px;
      text-transform:uppercase;
      color:#94a3b8;
      margin-top: 4px;
    }

    .nav-link{
      margin: 2px 12px;
      border-radius: 12px;
      padding: 12px 12px;
      display:flex;
      align-items:center;
      gap:10px;
      color:#334155;
      transition: .18s ease;
      border: 1px solid transparent;
    }

    .nav-link i{
      color:#64748b;
      font-size:1.05rem;
      transition:.18s ease;
    }

    .nav-link:hover{
      background: rgba(241,245,249,.9);
      transform: translateX(-2px);
      border-color: rgba(226,232,240,.9);
      color: var(--text-dark);
    }

    .nav-link.active{
      background: rgba(224,242,254,.70);
      color:#075985;
      font-weight:800;
      box-shadow: 0 10px 20px rgba(2,132,199,.10);
      border-color: rgba(2,132,199,.18);
    }

    .nav-link.active i{
      color: var(--primary);
    }

    /* --- Main Content --- */
    .main-wrapper{
      margin-right: var(--sidebar-width);
      padding: 40px;
      transition: margin-right .3s ease;
    }

    /* Nice header spacing */
    .top-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      margin-bottom: 22px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .page-heading h1{
      font-size: 1.85rem;
      font-weight: 900;
      color: var(--text-dark);
      margin-bottom: 6px;
      letter-spacing: -0.8px;
    }
    .page-heading p{
      color: var(--text-muted);
      font-size: .98rem;
      margin: 0;
      max-width: 58ch;
    }

    /* User pill in header */
    .top-header .rounded-pill{
      background: rgba(255,255,255,.92) !important;
      backdrop-filter: blur(8px);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border) !important;
    }

    /* Flash alert */
    .custom-flash-alert{
      background: linear-gradient(180deg, #dcfce7, #ecfdf5);
      color:#15803d;
      padding: 14px 16px;
      border-radius: 14px;
      margin-bottom: 18px;
      border: 1px solid rgba(187,247,208,.9);
      font-weight: 800;
      text-align:center;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      box-shadow: var(--shadow-sm);
      animation: fadeOut 5s forwards;
    }
    @keyframes fadeOut{
      0%{opacity:1;}
      80%{opacity:1;}
      100%{opacity:0; display:none;}
    }

    /* --- Table container (premium card) --- */
    .table-container{
      border-radius: var(--radius);
      box-shadow: var(--shadow-lg);
      border: 1px solid rgba(226,232,240,.85);
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(6px);
      overflow: hidden;
    }

    .table-toolbar{
      padding: 18px 22px;
      border-bottom: 1px solid rgba(226,232,240,.85);
      display:flex;
      justify-content:space-between;
      align-items:center;
      flex-wrap: wrap;
      gap: 10px;
      background: linear-gradient(180deg, rgba(248,250,252,1), rgba(255,255,255,1));
    }

    .filter-select{
      border: 1px solid rgba(226,232,240,.95);
      border-radius: 999px;
      padding: 9px 14px;
      font-size: .9rem;
      background: #fff;
      color: var(--text-dark);
      font-weight: 700;
      outline: none;
      box-shadow: var(--shadow-sm);
      transition: .2s;
      cursor: pointer;
    }
    .filter-select:hover{
      border-color: rgba(14,165,233,.35);
      box-shadow: 0 8px 18px rgba(2,132,199,.10);
    }

    .table{
      margin-bottom:0;
      width:100%;
      border-collapse: separate;
      border-spacing: 0;
    }

    .table th{
      background: rgba(248,250,252,.95);
      backdrop-filter: blur(6px);
      color:#475569;
      font-weight: 900;
      font-size: .78rem;
      text-transform: uppercase;
      padding: 16px 22px;
      border-bottom: 1px solid rgba(226,232,240,.9);
      white-space: nowrap;

      position: sticky;
      top: 0;
      z-index: 2;
    }

    .table td{
      padding: 16px 22px;
      vertical-align: middle;
      border-bottom: 1px solid rgba(226,232,240,.75);
      font-size: .95rem;
      color: var(--text);
    }

    .table tbody tr{
      transition: .15s ease;
    }
    .table tbody tr:nth-child(even){
      background: rgba(248,250,252,.55);
    }
    .table tbody tr:hover{
      background: rgba(224,242,254,.35);
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15,23,42,.06);
    }

    /* Status pills */
    .status-pill{
      display:inline-flex;
      align-items:center;
      padding: 4px 12px;
      border-radius: 999px;
      font-size: .82rem;
      font-weight: 800;
      text-transform: capitalize;
      border: 1px solid rgba(15,23,42,.06);
      box-shadow: 0 1px 0 rgba(15,23,42,.03);
    }
    .status-pill::before{
      content:'';
      display:inline-block;
      width: 7px;
      height: 7px;
      border-radius: 50%;
      margin-left: 8px;
    }

    .st-active{ background:#dcfce7; color:#166534; } .st-active::before{ background:#166534; }
    .st-full{ background:#ffedd5; color:#9a3412; } .st-full::before{ background:#9a3412; }
    .st-completed{ background:#f1f5f9; color:#475569; } .st-completed::before{ background:#475569; }
    .st-cancelled{ background:#fee2e2; color:#b91c1c; } .st-cancelled::before{ background:#b91c1c; }
    .st-delayed{ background:#fef9c3; color:#854d0e; } .st-delayed::before{ background:#854d0e; }

    /* Badges + progress look cleaner */
    .badge.bg-light{
      border-radius: 999px !important;
      padding: 8px 12px !important;
      box-shadow: var(--shadow-sm);
      border: 1px solid rgba(226,232,240,.9) !important;
    }
    .progress{
      background: rgba(226,232,240,.7);
      border-radius: 999px;
      overflow:hidden;
    }
    .progress-bar{
      border-radius: 999px;
    }

    /* Action icon button */
    .btn-icon{
      color:#94a3b8;
      background: rgba(255,255,255,.75);
      border: 1px solid rgba(226,232,240,.9);
      padding: 7px 9px;
      border-radius: 10px;
      transition: .2s;
      cursor:pointer;
      box-shadow: var(--shadow-sm);
    }
    .btn-icon:hover{
      background-color:#f1f5f9;
      color: var(--text-dark);
      border-color: rgba(226,232,240,1);
      transform: translateY(-1px);
    }
    .btn-icon.danger:hover{
      color:#dc2626;
      background-color:#fef2f2;
      border-color:#fee2e2;
    }

    /* Empty state */
    .table .bi-inbox{
      filter: drop-shadow(0 12px 28px rgba(15,23,42,.08));
    }

    /* --- Mobile Responsiveness --- */
    @media (max-width: 992px){
      .sidebar{
        transform: translateX(100%);
        width: 260px;
        right: 0;
      }
      .sidebar.show{ transform: translateX(0); }
      .main-wrapper{ margin-right: 0; padding: 20px; }
      .mobile-toggle{ display:block; }
    }
    @media (min-width: 993px){
      .mobile-toggle{ display:none; }
    }
  </style>
</head>

<body>
  <button
    class="btn btn-primary mobile-toggle position-fixed top-0 end-0 m-3 z-3"
    onclick="document.querySelector('.sidebar').classList.toggle('show')">
    <i class="bi bi-list"></i>
  </button>

  <aside class="sidebar">
    <a href="/manager" class="brand-area">
      <span class="brand-text">FLYTAU</span>
      <img src="{{ url_for('static', filename='LOGO.png') }}" alt="FLYTAU Logo" class="brand-logo" />
    </a>

    <div class="nav-category">ניהול שוטף</div>
    <nav class="nav flex-column">
      <a href="/manager" class="nav-link active"><i class="bi bi-grid-1x2"></i> לוח טיסות</a>
      <a href="/manager/add_flight/step1" class="nav-link"><i class="bi bi-plus-lg"></i> הוספת טיסה</a>
      <a href="/manager/add_plane" class="nav-link"><i class="bi bi-airplane"></i> הוספת מטוס</a>
      <a href="/manager/add_staff" class="nav-link"><i class="bi bi-people"></i> ניהול צוות</a>
    </nav>

    <div class="nav-category">מערכת</div>
    <nav class="nav flex-column">
      <a href="/manager/reports" class="nav-link"><i class="bi bi-bar-chart"></i> דוחות ניהוליים</a>
      <a href="/logout" class="nav-link text-danger mt-4"><i class="bi bi-box-arrow-right"></i> יציאה</a>
    </nav>
  </aside>

  <main class="main-wrapper">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="custom-flash-alert">
            <i class="bi bi-check-circle-fill"></i> {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <header class="top-header">
      <div class="page-heading">
        <h1>ניהול טיסות</h1>
        <p>סקירה כללית, סטטוסים וניהול לו"ז בזמן אמת</p>
      </div>

      <div class="d-flex align-items-center gap-3">
        <div class="d-flex align-items-center gap-2 bg-white px-3 py-2 rounded-pill border shadow-sm">
          <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold" style="width:32px;height:32px;">
            {{ manager_name[0] | upper if manager_name else 'M' }}
          </div>
          <span class="small fw-bold text-dark">שלום, {{ manager_name or 'מנהל' }}</span>
        </div>
      </div>
    </header>

    <div class="table-container">
      <div class="table-toolbar">
        <h5 class="fw-bold m-0 text-dark">לוח טיסות</h5>
        <form method="GET" action="/manager">
          <select name="status" id="statusFilter" class="filter-select" onchange="this.form.submit()">
            <option value="all" {% if current_filter == 'all' %}selected{% endif %}>הצג הכל</option>
            <option value="active" {% if current_filter == 'active' %}selected{% endif %}>Active (פעילות)</option>
            <option value="completed" {% if current_filter == 'completed' %}selected{% endif %}>Completed (הושלמו)</option>
            <option value="cancelled" {% if current_filter == 'cancelled' %}selected{% endif %}>Cancelled (מבוטלות)</option>
          </select>
        </form>
      </div>

      <div class="table-responsive">
        <table class="table" id="flightsTable">
          <thead>
            <tr>
              <th>מזהה (ID)</th>
              <th>נתיב</th>
              <th>מטוס</th>
              <th>המראה</th>
              <th>תפוסה</th>
              <th>סטטוס</th>
              <th class="text-end">פעולות</th>
            </tr>
          </thead>

          <tbody>
            {% if flights %}
              {% for flight in flights %}
                <tr>
                  <td class="font-monospace text-muted">#{{ flight.flight_id }}</td>

                  <td>
                    <strong>{{ flight.origin }}</strong>
                    <i class="bi bi-arrow-left mx-1 text-muted"></i>
                    <strong>{{ flight.destination }}</strong>
                  </td>

                  <td>
                    <span class="badge bg-light text-dark border">
                      <i class="bi bi-airplane me-1"></i> {{ flight.plane_id }}
                    </span>
                  </td>

                  <td dir="ltr">
                    {{ flight.departure.strftime('%d/%m/%Y %H:%M') if flight.departure else '-' }}
                  </td>

                  <td>
                    <div class="d-flex align-items-center gap-2">
                      <span>{{ flight.occupied }} / {{ flight.capacity }}</span>
                      {% set percent = (flight.occupied / flight.capacity * 100) | round | int %}
                      <div class="progress" style="width: 60px; height: 6px;">
                        <div
                          class="progress-bar bg-{{ 'success' if percent < 80 else 'warning' }}"
                          role="progressbar"
                          style="width: {{ percent }}%">
                        </div>
                      </div>
                    </div>
                  </td>

                  <td>
                    <span class="status-pill st-{{ flight.status | lower }}">
                      {{ flight.status }}
                    </span>
                  </td>

                  <td class="text-end">
                    {% if flight.status | lower != 'cancelled' and flight.status | lower != 'completed'  %}
                      <form method="POST" action="/manager/delete_flight" style="display:inline;">
                        <input type="hidden" name="flight_id" value="{{ flight.flight_id }}">
                        <button
                          type="submit"
                          class="btn-icon danger"
                          title="בטל טיסה"
                          onclick="return confirm('האם אתה בטוח שברצונך לבטל את הטיסה הזו?')">
                          <i class="bi bi-trash"></i>
                        </button>
                      </form>
                    {% else %}
                      <span class="text-muted small">-</span>
                    {% endif %}
                  </td>
                </tr>
              {% endfor %}
            {% else %}
              <tr>
                <td colspan="7" class="text-center py-5">
                  <div class="text-muted">
                    <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                    לא נמצאו טיסות התואמות לחיפוש
                  </div>
                </td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
pip install matplotlib
