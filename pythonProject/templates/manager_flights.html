<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlyTau Manager - דוחות וניהול מערכת</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            --flytau-navy: #001b33;
            --flytau-teal: #00818a;
            --bg-light: #f1f5f9;
            --white: #ffffff;
            --purple-gradient: linear-gradient(135deg, #6366f1 0%, #a855f7 100%);
            --card-shadow: 0 10px 30px rgba(0,0,0,0.05);
        }

        body {
            font-family: 'Heebo', sans-serif;
            background-color: var(--bg-light);
            color: var(--flytau-navy);
            margin: 0;
            padding-bottom: 50px;
        }

        /* --- Navbar --- */
        .navbar {
            background: var(--white);
            padding: 10px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-brand img {
            height: 65px; /* לוגו בולט */
            object-fit: contain;
        }

        .nav-links-area {
            display: flex;
            align-items: center;
            gap: 25px;
        }

        .nav-link-custom {
            color: var(--flytau-navy);
            font-weight: 700;
            text-decoration: none;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
        }

        .nav-link-custom:hover { color: var(--flytau-teal); }

        .btn-status {
            background: #f1f0ff;
            color: #6366f1;
            border: none;
            padding: 8px 18px;
            border-radius: 12px;
            font-weight: 800;
            font-size: 14px;
        }

        /* --- Hero Banner --- */
        .hero-banner {
            background: var(--purple-gradient);
            border-radius: 24px;
            padding: 45px;
            color: white;
            text-align: center;
            margin: 25px 40px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.2);
        }

        .hero-banner h1 { font-size: 38px; font-weight: 900; margin-bottom: 10px; position: relative; z-index: 1; }
        .hero-banner p { font-size: 18px; opacity: 0.9; position: relative; z-index: 1; }

        /* --- Stats Cards Grid --- */
        .stats-grid {
            padding: 0 40px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--card-shadow);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .stat-content h6 { font-size: 13px; color: #64748b; font-weight: 700; margin-bottom: 10px; }
        .stat-content .value { font-size: 32px; font-weight: 900; line-height: 1; margin-bottom: 8px; }
        .stat-content .sub-text { font-size: 12px; font-weight: 600; }

        .stat-icon-box {
            width: 54px;
            height: 54px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .bg-icon-orange { background: #fff7ed; color: #f97316; }
        .bg-icon-green { background: #f0fdf4; color: #22c55e; }
        .bg-icon-purple { background: #faf5ff; color: #a855f7; }
        .bg-icon-blue { background: #eff6ff; color: #3b82f6; }

        /* --- Main Charts Section --- */
        .dashboard-main {
            padding: 0 40px;
            display: grid;
            grid-template-columns: 1fr 1.8fr;
            gap: 20px;
        }

        .chart-container {
            background: var(--white);
            padding: 30px;
            border-radius: 24px;
            box-shadow: var(--card-shadow);
        }

        .chart-header {
            margin-bottom: 25px;
        }

        .chart-header h5 { font-size: 17px; font-weight: 800; margin: 0; }
        .chart-header p { font-size: 13px; color: #64748b; margin: 0; }

        .badge-active { background: #dcfce7; color: #15803d; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; }
    </style>
</head>
<body>

    <nav class="navbar d-flex justify-content-between">
        <div class="d-flex align-items-center">
            <a class="navbar-brand" href="/manager">
                <img src="{{ url_for('static', filename='LOGO.jpeg') }}" alt="FLYTAU Logo">
            </a>
            <div class="nav-links-area ms-5">
                <a href="/manager" class="nav-link-custom"><i class="bi bi-search"></i> חיפוש טיסות</a>
                <a href="/manager" class="nav-link-custom"><i class="bi bi-airplane-engines"></i> ניהול טיסות</a>
            </div>
        </div>
        
        <div class="d-flex align-items-center gap-3">
            <button class="btn-status">דוחות <i class="bi bi-text-left"></i></button>
            <a href="/logout" class="nav-link-custom text-muted small"><i class="bi bi-box-arrow-right"></i> התנתק</a>
        </div>
    </nav>

    <div class="hero-banner">
        <h1>דוחות ניהוליים</h1>
        <p>סטטיסטיקות וניתוח פעילות עסקית</p>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-content">
                <h6>עובדים</h6>
                <div class="value">{{ total_staff }}</div>
                <div class="sub-text text-muted">3 טייסים | 6 דיילים</div>
            </div>
            <div class="stat-icon-box bg-icon-orange"><i class="bi bi-people-fill"></i></div>
        </div>

        <div class="stat-card">
            <div class="stat-content">
                <h6>הכנסות כוללות</h6>
                <div class="value">₪{{ "{:,.0f}".format(total_income) }}</div>
                <div class="sub-text text-success"><i class="bi bi-graph-up-arrow"></i> מכל ההזמנות</div>
            </div>
            <div class="stat-icon-box bg-icon-green"><i class="bi bi-currency-dollar"></i></div>
        </div>

        <div class="stat-card">
            <div class="stat-content">
                <h6>סה"כ הזמנות</h6>
                <div class="value">{{ total_orders }}</div>
                <div class="sub-text text-muted">כל ההזמנות במערכת</div>
            </div>
            <div class="stat-icon-box bg-icon-purple"><i class="bi bi-calendar-check"></i></div>
        </div>

        <div class="stat-card">
            <div class="stat-content">
                <h6>סה"כ טיסות</h6>
                <div class="value">{{ flights|length }}</div>
                <span class="badge-active">5 פעילות</span>
            </div>
            <div class="stat-icon-box bg-icon-blue"><i class="bi bi-airplane-fill"></i></div>
        </div>
    </div>

    <div class="dashboard-main">
        <div class="chart-container">
            <div class="chart-header">
                <h5>התפלגות סטטוס טיסות</h5>
                <p>מצב הטיסות במערכת</p>
            </div>
            <canvas id="statusChart" height="250"></canvas>
        </div>

        <div class="chart-container">
            <div class="chart-header">
                <h5>הכנסות לפי יעד</h5>
                <p>התפלגות ההכנסות לפי שדות תעופה</p>
            </div>
            <canvas id="incomeChart" height="130"></canvas>
        </div>
    </div>

    <script>
        // 1. נתוני סטטוס טיסות מ-Python
        const statusDict = {{ status_dict|tojson }};
        
        const ctxStatus = document.getElementById('statusChart').getContext('2d');
        new Chart(ctxStatus, {
            type: 'doughnut',
            data: {
                labels: Object.keys(statusDict),
                datasets: [{
                    data: Object.values(statusDict),
                    backgroundColor: ['#22c55e', '#3b82f6', '#ef4444', '#f97316'],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                cutout: '75%',
                plugins: {
                    legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20, font: { family: 'Heebo', weight: 'bold' } } }
                }
            }
        });

        // 2. נתוני הכנסות לפי יעד מ-Python
        const destLabels = {{ dest_labels|tojson }};
        const destValues = {{ dest_values|tojson }};

        const ctxIncome = document.getElementById('incomeChart').getContext('2d');
        new Chart(ctxIncome, {
            type: 'bar',
            data: {
                labels: destLabels,
                datasets: [{
                    label: 'הכנסה ב-₪',
                    data: destValues,
                    backgroundColor: '#6366f1',
                    borderRadius: 12,
                    barThickness: 45
                }]
            },
            options: {
                plugins: { legend: { display: false } },
                scales: {
                    y: { beginAtZero: true, grid: { color: '#f1f5f9' }, ticks: { font: { family: 'Heebo' } } },
                    x: { grid: { display: false }, ticks: { font: { family: 'Heebo', weight: 'bold' } } }
                }
            }
        });
    </script>

</body>
</html>